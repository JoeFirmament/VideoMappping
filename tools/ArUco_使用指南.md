# ArUco标记生成和使用指南

## 1. 生成适合A4打印的标记

### 推荐方案：每张A4纸打印一个标记

```bash
# 切换到tools目录
cd tools

# 生成单个标记（ID=0）
python3 generate_aruco_a4.py --id 0

# 批量生成多个标记（ID 0-3）
python3 generate_aruco_a4.py --batch --id 3

# 高质量打印（600 DPI）
python3 generate_aruco_a4.py --batch --id 3 --dpi 600
```

### 生成的标记特点
- **尺寸**: 150mm x 150mm (在A4纸上居中)
- **字典**: DICT_4X4_50 (与主程序一致)
- **格式**: 高质量PNG文件
- **包含**: 标记ID、尺寸信息、参考十字线

## 2. 打印设置

### 推荐打印设置
1. **打印机**: 激光打印机或高质量喷墨打印机
2. **纸张**: 白色A4纸 (确保良好对比度)
3. **缩放**: 选择"实际尺寸"或"100%"，不要自动缩放
4. **质量**: 选择最高打印质量
5. **颜色**: 黑白打印即可

### 打印后检查
- 标记边缘清晰，没有模糊
- 黑白对比度明显
- 标记尺寸准确 (可用尺子测量)
- 没有打印污迹或墨点

## 3. 在VideoMapping系统中使用

### 启用ArUco模式
1. 打开VideoMapping系统的Web界面
2. 在控制面板中找到"ArUco标记检测"部分
3. 点击"启用ArUco模式"按钮

### 标定步骤
1. **放置标记**: 将打印好的标记放在摄像头视野内的不同位置
2. **设置地面坐标**: 为每个检测到的标记设置实际的地面坐标
3. **执行标定**: 点击"从ArUco标记标定"进行单应性矩阵计算

### 标记放置建议
- **数量**: 至少4个标记 (建议6-8个)
- **分布**: 均匀分布在监控区域内
- **角度**: 标记应该平贴地面，避免倾斜
- **距离**: 标记之间保持适当距离，不要重叠

## 4. 调试技巧

### 检测问题排查
1. **标记未检测到**:
   - 检查光照条件，避免过强或过弱的光线
   - 确保标记平整，没有弯曲或折痕
   - 调整摄像头焦距，确保标记清晰

2. **检测不稳定**:
   - 确保标记与背景有足够对比度
   - 避免标记在摄像头视野边缘
   - 检查标记是否有污损或磨损

3. **标定精度不高**:
   - 增加标记数量
   - 确保标记分布均匀
   - 精确测量和输入地面坐标

### 系统日志监控
```bash
# 查看ArUco检测日志
grep -i aruco /var/log/videomapping.log

# 实时监控检测状态
tail -f /var/log/videomapping.log | grep -i aruco
```

## 5. 标记管理

### 文件组织
```
aruco_a4/
├── ArUco_ID00_A4_300dpi.png  # 标记0
├── ArUco_ID01_A4_300dpi.png  # 标记1
├── ArUco_ID02_A4_300dpi.png  # 标记2
└── ArUco_ID03_A4_300dpi.png  # 标记3
```

### 标记标识
- 每个标记都在图像上标注了ID号
- 建议在打印后用笔在背面写上ID号
- 可以用透明胶带保护标记表面

## 6. 最佳实践

### 标定环境
- **室内照明**: 使用均匀的室内照明，避免阴影
- **背景**: 深色地面效果最好
- **稳定性**: 确保摄像头固定，避免振动

### 标记维护
- 定期检查标记是否有磨损
- 保持标记清洁，避免污渍
- 存储时避免折痕和弯曲

### 性能优化
- 使用足够数量的标记提高精度
- 标记分布要覆盖整个监控区域
- 定期重新标定以保持精度 