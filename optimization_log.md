# VideoMapping 优化日志

## 2024-12-19 局域网双分辨率策略优化

### 问题背景
程序中引入了1280x720的硬编码降采样，与原有的双分辨率设计产生冲突。

### 原有双分辨率设计
```cpp
displayWidth_ = 960;      // 显示分辨率：16:9比例，用于实时显示
displayHeight_ = 540;
detectionWidth_ = 1920;   // 检测分辨率：高精度，用于准确检测  
detectionHeight_ = 1080;
```

### 本次修改内容

#### 1. 移除网络传输强制降采样
- **文件**: `src/VideoStreamer.cpp`
- **位置**: `broadcastFrame()`函数
- **修改**: 移除1280x720硬编码降采样逻辑
- **原因**: 局域网环境下不需要考虑网络带宽限制

#### 2. 优化JPEG质量设置
- **默认质量**: 85 → 92 (提高12%)
- **快速模式阈值**: 3次超时 → 5次超时 (提高容错性)
- **快速模式质量**: 60 → 75 (提高25%)
- **多连接影响**: 减少质量下降幅度

#### 3. 修复变量命名规范
- `now` → `broadcastReportTime` (广播性能报告)
- `now` → `undistortLogTime` (去畸变日志)  
- `now` → `frameReportTime` (帧处理报告)
- `cv::FileStorage::read` → `cv::FileStorage::READ` (OpenCV常量修正)

### 性能预期
1. **图像质量提升**: 更高的JPEG质量设置
2. **分辨率保持**: 不再有额外的降采样损失
3. **编码效率**: 保持双分辨率设计的性能优势
4. **网络适应**: 仍保留动态质量调整机制

### 平台信息
- **开发平台**: Linux ARM64 (Rock 5C)
- **CPU类型**: RK3588S  
- **操作系统**: Ubuntu 20.04
- **网络环境**: 局域网 (WiFi + 有线双网卡)

### 下一步
- 测试编译是否成功
- 验证双分辨率策略是否正常工作
- 监控局域网环境下的性能表现 