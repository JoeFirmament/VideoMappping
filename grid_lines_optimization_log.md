# å•åº”æ€§çŸ©é˜µç»¿è‰²ç½‘æ ¼çº¿ä¼˜åŒ–æ—¥å¿—

## ä¼˜åŒ–æ—¶é—´
2024å¹´12æœˆ19æ—¥

## é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆï¼šå‰ç«¯åœ¨å•åº”æ€§çŸ©é˜µæ˜¾ç¤ºçš„æ ‡å®šåçš„ç»¿è‰²çº¿ï¼Œè¦†ç›–èŒƒå›´å¤ªå°ï¼Œä¸å¤Ÿæ˜æ˜¾ã€‚

## åŸå§‹æ˜¾ç¤ºé€»è¾‘åˆ†æ

### è§¦å‘æ¡ä»¶
- å¿…é¡»å·²å®Œæˆå•åº”æ€§çŸ©é˜µæ ‡å®šï¼š`homographyMapper_.isCalibrated()`
- å¿…é¡»æœ‰è‡³å°‘4ä¸ªæ ‡å®šç‚¹ï¼š`points.size() >= 4`
- åœ¨æ ‡å®šæ¨¡å¼ä¸‹ï¼š`calibrationMode_`

### ç»˜åˆ¶ä½ç½®
**æ–‡ä»¶**: `src/VideoStreamer.cpp:675-725` çš„ `drawCalibrationPoints()` æ–¹æ³•

### åŸå§‹å‚æ•°
```cpp
int gridSize = 50;     // ç½‘æ ¼å¤§å°ï¼ˆåœ°é¢åæ ‡ç³»ä¸­50å•ä½ï¼‰
int gridCount = 10;    // ç½‘æ ¼æ•°é‡ï¼ˆæœ€å¤š10æ¡çº¿ï¼‰
int lineThickness = 1; // çº¿æ¡ç²—ç»†ï¼ˆ1åƒç´ ï¼‰
cv::Scalar color = cv::Scalar(0, 255, 0); // ç»¿è‰²
```

### åŸå§‹è¦†ç›–èŒƒå›´
- **é™åˆ¶**ï¼šä»…åœ¨æ ‡å®šç‚¹çš„è¾¹ç•Œæ¡†å†…ç»˜åˆ¶
- **è®¡ç®—æ–¹å¼**ï¼š
  ```cpp
  // æ‰¾åˆ°æ ‡å®šç‚¹çš„æœ€å°/æœ€å¤§åæ ‡
  for (const auto& point : points) {
      minX = std::min(minX, point.second.x);
      minY = std::min(minY, point.second.y);
      maxX = std::max(maxX, point.second.x);
      maxY = std::max(maxY, point.second.y);
  }
  ```

## ä¼˜åŒ–æ”¹è¿› âœ…

### 1. å¢åŠ ç½‘æ ¼å¯†åº¦
```cpp
// ä¼˜åŒ–å‰
int gridSize = 50;     // ç½‘æ ¼é—´è·50å•ä½
int gridCount = 10;    // æœ€å¤š10æ¡çº¿

// ä¼˜åŒ–å
int gridSize = 25;     // ç½‘æ ¼é—´è·25å•ä½ï¼ˆå¯†åº¦ç¿»å€ï¼‰
int gridCount = 20;    // æœ€å¤š20æ¡çº¿ï¼ˆè¦†ç›–èŒƒå›´ç¿»å€ï¼‰
```

### 2. æ‰©å±•è¦†ç›–èŒƒå›´
```cpp
// ğŸ”§ æ–°å¢ï¼šæ‰©å±•è¾¹ç•Œæ¡†ï¼Œå¢åŠ è¦†ç›–èŒƒå›´
float expandRatio = 0.5f; // å‘å¤–æ‰©å±•50%
float rangeX = maxX - minX;
float rangeY = maxY - minY;
minX -= rangeX * expandRatio;
maxX += rangeX * expandRatio;
minY -= rangeY * expandRatio;
maxY += rangeY * expandRatio;
```

### 3. å¢å¼ºçº¿æ¡å¯è§æ€§
```cpp
// ä¼˜åŒ–å‰
cv::line(frame, start, end, cv::Scalar(0, 255, 0), 1);

// ä¼˜åŒ–å
cv::line(frame, start, end, cv::Scalar(0, 255, 0), 2, cv::LINE_AA);
// - çº¿æ¡ç²—ç»†ä»1åƒç´ å¢åŠ åˆ°2åƒç´ 
// - æ·»åŠ æŠ—é”¯é½¿æ•ˆæœï¼ˆcv::LINE_AAï¼‰
```

### 4. ä¼˜åŒ–åæ ‡æ ‡è®°
```cpp
// ä¼˜åŒ–å‰ï¼šæ¯æ¡çº¿éƒ½æ˜¾ç¤ºåæ ‡
cv::putText(frame, std::to_string(int(y)), 
           cv::Point(start.x + 5, start.y), 
           cv::FONT_HERSHEY_SIMPLEX, 0.3, cv::Scalar(0, 255, 0), 1);

// ä¼˜åŒ–åï¼šåªåœ¨å¶æ•°çº¿æ˜¾ç¤ºåæ ‡ï¼Œé¿å…æ‹¥æŒ¤
if (i % 2 == 0) {
    cv::putText(frame, std::to_string(int(y)), 
               cv::Point(std::max(5.0f, start.x + 5), std::max(15.0f, start.y)), 
               cv::FONT_HERSHEY_SIMPLEX, 0.4, cv::Scalar(0, 255, 0), 1, cv::LINE_AA);
}
```

### 5. æ·»åŠ è¾¹ç•Œæ£€æŸ¥
```cpp
// ğŸ”§ æ–°å¢ï¼šæ£€æŸ¥çº¿æ¡æ˜¯å¦åœ¨å›¾åƒèŒƒå›´å†…
if ((start.x >= 0 || end.x >= 0) && (start.x < frame.cols || end.x < frame.cols) &&
    (start.y >= 0 || end.y >= 0) && (start.y < frame.rows || end.y < frame.rows)) {
    // åªç»˜åˆ¶åœ¨å›¾åƒèŒƒå›´å†…çš„çº¿æ¡
    cv::line(frame, start, end, cv::Scalar(0, 255, 0), 2, cv::LINE_AA);
}
```

## ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

### ä¼˜åŒ–å‰
- **ç½‘æ ¼å¯†åº¦**: 50å•ä½é—´è·ï¼Œç¨€ç–
- **è¦†ç›–èŒƒå›´**: ä»…é™æ ‡å®šç‚¹è¾¹ç•Œæ¡†
- **çº¿æ¡ç²—ç»†**: 1åƒç´ ï¼Œä¸å¤Ÿæ˜æ˜¾
- **åæ ‡æ ‡è®°**: æ¯æ¡çº¿éƒ½æœ‰ï¼Œæ˜¾å¾—æ‹¥æŒ¤
- **è¾¹ç•Œå¤„ç†**: æ— æ£€æŸ¥ï¼Œå¯èƒ½ç»˜åˆ¶åˆ°å›¾åƒå¤–

### ä¼˜åŒ–å
- **ç½‘æ ¼å¯†åº¦**: 25å•ä½é—´è·ï¼Œå¯†åº¦ç¿»å€
- **è¦†ç›–èŒƒå›´**: å‘å¤–æ‰©å±•50%ï¼Œè¦†ç›–æ›´å¤§åŒºåŸŸ
- **çº¿æ¡ç²—ç»†**: 2åƒç´  + æŠ—é”¯é½¿ï¼Œæ›´åŠ æ˜æ˜¾
- **åæ ‡æ ‡è®°**: åªåœ¨å¶æ•°çº¿æ˜¾ç¤ºï¼Œæ¸…æ™°ä¸æ‹¥æŒ¤
- **è¾¹ç•Œå¤„ç†**: æ™ºèƒ½æ£€æŸ¥ï¼Œåªç»˜åˆ¶æœ‰æ•ˆåŒºåŸŸ

## é¢„æœŸæ”¹è¿›æ•ˆæœ

1. **å¯è§æ€§æå‡**: çº¿æ¡æ›´ç²—ã€æ›´æ¸…æ™°
2. **è¦†ç›–èŒƒå›´æ‰©å¤§**: æ¯”åŸæ¥å¤§50%çš„æ˜¾ç¤ºåŒºåŸŸ
3. **ç½‘æ ¼å¯†åº¦å¢åŠ **: æ›´ç²¾ç»†çš„ç½‘æ ¼åˆ’åˆ†
4. **æ€§èƒ½ä¼˜åŒ–**: è¾¹ç•Œæ£€æŸ¥é¿å…æ— æ•ˆç»˜åˆ¶
5. **è§†è§‰ä½“éªŒ**: åæ ‡æ ‡è®°æ›´æ¸…æ™°ï¼Œä¸æ‹¥æŒ¤

## è°ƒè¯•éªŒè¯

### éªŒè¯æ­¥éª¤
1. å®Œæˆå•åº”æ€§çŸ©é˜µæ ‡å®šï¼ˆè‡³å°‘4ä¸ªç‚¹ï¼‰
2. è§‚å¯Ÿç»¿è‰²ç½‘æ ¼çº¿çš„æ˜¾ç¤ºæ•ˆæœ
3. æ£€æŸ¥ç½‘æ ¼çº¿æ˜¯å¦è¦†ç›–æ›´å¤§èŒƒå›´
4. éªŒè¯çº¿æ¡æ˜¯å¦æ›´åŠ æ˜æ˜¾
5. ç¡®è®¤åæ ‡æ ‡è®°æ˜¯å¦æ¸…æ™°

### æ—¥å¿—è¾“å‡º
```bash
# åœ¨æ ‡å®šå®Œæˆåï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡º
ğŸ“ [COORDINATE CALIBRATION] æ ‡å®šæ¨¡å¼: å¯ç”¨
âœ… [HOMOGRAPHY] å•åº”æ€§çŸ©é˜µè®¡ç®—æˆåŠŸ
```

## ç›¸å…³æ–‡ä»¶
- `src/VideoStreamer.cpp:675-725` - ç½‘æ ¼çº¿ç»˜åˆ¶é€»è¾‘
- `src/HomographyMapper.cpp:510-544` - åŸºç¡€ç½‘æ ¼ç»˜åˆ¶æ–¹æ³•

## ç‰ˆæœ¬æ ‡è®°
- **ä¼˜åŒ–ç‰ˆæœ¬**: v2.3-grid-lines-enhancement
- **Gitæäº¤**: "enhance: improve grid lines visibility and coverage for homography calibration"

## æœªæ¥æ”¹è¿›å»ºè®®
1. æ·»åŠ ç½‘æ ¼çº¿é¢œè‰²é…ç½®é€‰é¡¹
2. æ”¯æŒåŠ¨æ€è°ƒæ•´ç½‘æ ¼å¯†åº¦
3. æ·»åŠ ç½‘æ ¼çº¿é€æ˜åº¦æ§åˆ¶
4. æ”¯æŒä¸åŒçš„ç½‘æ ¼æ ·å¼ï¼ˆè™šçº¿ã€ç‚¹çº¿ç­‰ï¼‰ 