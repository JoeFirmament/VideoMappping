# VideoMapping

视频映射应用程序，用于实时视频流的坐标映射和标定。

## 功能特点

- **实时视频流显示** - 支持1920×1080高清视频流
- **相机内参标定** - 棋盘格自动检测，支持镜头畸变校正
- **坐标变换标定** - 图像坐标到地面坐标的映射
- **ArUco标记检测** - 自动标记识别和坐标标定
- **双分辨率优化** - 显示流畅(960×540) + 检测精确(1920×1080)
- **多语言支持** - 中文/英文界面
- **标定结果保存和加载** - 支持标定数据持久化

## 最新更新 ✨

### v2.0 - 双分辨率性能优化
- 🚀 **性能提升**: 标定模式下视频流畅度提升6倍 (<5fps → 30fps)
- 🎯 **精度保持**: 检测仍使用1920×1080高分辨率，成功率92%
- 🎨 **UI优化**: 紧凑化设计，分辨率信息实时显示
- 📊 **数据优化**: WebSocket传输压力降低75%

详细信息请查看 [双分辨率优化文档](docs/dual-resolution-optimization.md)

## 系统要求

- Linux 操作系统 (推荐RK3588平台)
- OpenCV 库 (>= 4.0)
- Crow 框架（C++ Web 框架）
- 现代网络浏览器
- USB摄像头 (支持1920×1080@30fps)

## 安装指南

1. 克隆仓库：
   ```bash
   git clone https://github.com/JoeFirmament/VideoMappping.git
   cd VideoMapping
   ```

2. 编译项目：
   ```bash
   mkdir -p build
   cd build
   cmake ..
   make -j$(nproc)
   ```

3. 运行应用程序：
   ```bash
   ./video_mapping
   ```

4. 在浏览器中访问：
   ```
   http://localhost:8080
   ```

## 使用方法

### 视频流控制
- 点击"开始"按钮开始视频流
- 点击"停止"按钮停止视频流
- 点击"全屏"按钮进入全屏模式

### 相机内参标定 🎯
1. **准备棋盘格**: 使用8×5内角点的标准棋盘格
2. **参数设置**: 
   - 角点宽度: 8, 角点高度: 5
   - 方格大小: 30mm (实际测量值)
   - 高斯模糊核: 5×5 (适用于低光环境)
3. **标定模式**: 点击"相机标定模式"
4. **自动采集**: 设置采集时间(10秒)和间隔(500ms)，点击"开始自动采集"
5. **执行标定**: 采集完成后点击"执行标定"
6. **保存结果**: 标定成功后点击"保存标定结果"

### 坐标变换标定
1. 点击"进入标定模式"按钮
2. 在地面 X 和地面 Y 输入框中输入坐标值
3. 点击视频画面添加标定点（至少需要 4 个点）
4. 点击"计算单应性矩阵"按钮进行标定
5. 标定完成后，可以点击"保存标定结果"按钮保存标定结果

### ArUco标记标定
1. 打印ArUco标记 (4×4字典, ID: 0-49)
2. 点击"启用ArUco模式"
3. 为检测到的标记设置地面坐标
4. 点击"从ArUco标记标定"完成自动标定

### 坐标转换
1. 标定完成后，点击视频画面上的任意点
2. 应用程序会自动计算并显示对应的地面坐标

## 性能特点

### 双分辨率架构
```
正常模式:  1920×1080 (单流) → 完整质量显示
标定模式:  960×540 (显示) + 1920×1080 (检测) → 流畅+精确
```

### 检测算法优化
- 7种渐进检测方法
- 自适应阈值处理
- 高斯模糊增强
- 亚像素级角点精化

## 项目结构

```
VideoMapping/
├── src/                    # 源代码文件
│   ├── main.cpp           # 主程序入口
│   ├── VideoStreamer.cpp  # 视频流处理和双分辨率优化
│   ├── CameraCalibrator.cpp # 相机标定算法
│   └── HomographyMapper.cpp # 坐标转换
├── include/               # 头文件
├── static/                # 前端文件
│   ├── index.html        # 主界面 (紧凑化设计)
│   ├── script.js         # JavaScript逻辑
│   ├── styles.css        # 样式文件
│   └── i18n.js          # 多语言支持
├── docs/                 # 文档文件
│   └── dual-resolution-optimization.md
├── tools/                # 工具脚本
└── calibration_images/   # 标定图片存储
```

## 技术亮点

- **高效视频处理**: 基于OpenCV的优化图像处理管道
- **实时WebSocket通信**: 低延迟视频流传输
- **智能检测算法**: 多方法融合的棋盘格检测
- **响应式设计**: 适配不同设备的现代化界面
- **模块化架构**: 松耦合的组件设计

## 许可证

[MIT License](LICENSE)

## 贡献指南

欢迎提交 Issue 和 Pull Request 来改进这个项目。

### 开发指南
1. Fork 项目
2. 创建特性分支 (`git checkout -b feature/amazing-feature`)
3. 提交更改 (`git commit -m 'Add amazing feature'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 打开 Pull Request

## 更新日志

### v2.0.0 (2024-06-05)
- ✨ 新增双分辨率优化架构
- 🚀 标定模式性能提升6倍
- 🎨 UI界面紧凑化重设计
- 🌐 完善多语言支持
- 🔧 修复WebSocket状态同步问题

### v1.0.0 (2024-05-01)
- 🎉 首次发布
- 📹 基础视频流功能
- 📐 坐标变换标定
- 🏷️ ArUco标记检测
